/*
  Copyright (c) 2008 Ingres Corporation

  Test Name     : utl70.sep
  Suite         : be!util
  Focus         : Ingres Regression Test
                : Test for bug 119967 - auditdb creates an invalid -file 
                : which will return E_CO0032 or E_CO002A when you attempt to
                : load it via a copy table from ..... statement
                :
  Databases     : b119967db 
  Tables        : b119967_*
  Filled Files  : 
  Copied Files  :
  Output Files  :
  Prerequisites : None
  Run as user   : testenv 
  Summary       : Verifies fix for bug 119967
                :
                :
  Exp. DIFFs    : None
                :
  History       : 1-Sep-2008 (wanfr01) Created.
                : 1-Sep-2008 (sarjo01) Formalized for piccolo.
                : 03-Nov-2008 (wanfr01) No need to disable journaling on
                :	one time use databases.
*/
? fill b119967_1t2.trl
!!
!!
? fill b119967_1t3.trl
!!
!!
? fill b119967_1t4.trl
!!
!!
? fill b119967_1t5.trl
!!
!!
? fill b119967_1t6.trl
!!
!!
? fill b119967_1t7.trl
!!
!!
? fill b119967_1t8.trl
!!
!!
? fill b119967_1t9.trl
!!
!!
? fill b119967_1t.trl
!!
!!
? destroydb b119967db
<<
~
>>
? createdb b119967db
<<
~
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t\g
<<
~
>>
* create table b119967_1t ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* drop table b119967_2t\g
<<
~
>>
* create table b119967_2t ( -
date date not null with default, -
username char(32) not null with default, -
operation char(8) not null with default, -
tranid1 integer4 not null with default, -
tranid2 integer4 not null with default, -
table_id1 integer4 not null with default, -
table_id2 integer4 not null with default, -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with nojournaling;  \g
<<
>>
* insert into b119967_1t values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','them2','');  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t () from 'b119967_1t.trl' \g
<<
(2 rows)
>>
* \q
<<
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t2\g
<<
~
>>
* create table b119967_1t2 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* drop table b119967_2t2\g
<<
~
>>
* create table b119967_2t2 ( -
date date not null with default, -
username char(32) not null with default, -
operation char(8) not null with default, -
tranid1 integer4 not null with default, -
tranid2 integer4 not null with default, -
table_id1 integer4 not null with default, -
table_id2 integer4 not null with default, -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with nojournaling;  \g
<<
>>
* insert into b119967_1t2 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','julie1 blob data1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t2 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','julie2 blob data2','them2','');  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t2 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t2 () from 'b119967_1t2.trl' \g
<<
(2 rows)
>>
* \q
<<
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t3\g
<<
~
>>
* create table b119967_1t3 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* insert into b119967_1t3 values (1,'now','notetype_name1',null,'GGG Long Varchar 1 GGG','today','you1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t3 values (2,'now','notetype_name2',null,'YYY Long Varchar 2 YYY','today','you2','them2','');  \g
<<
(1 row)
>>
* \q
<<
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* update b119967_1t3 set update_usr='mikey' where notes_id=1;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t3  b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t () from 'b119967_1t3.trl' \g
<<
(2 rows)
>>
* \q
<<
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t4\g
<<
~
>>
* create table b119967_1t4 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null ) with journaling;  \g
<<
>>
* insert into b119967_1t4 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t4 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','them2','');  \g
<<
(1 row)
>>
* update b119967_1t4 set notes_text='blahblahblah' where notes_id = 2;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 3  
<<
~
>>
? auditdb -file -table=b119967_1t4 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t () from 'b119967_1t4.trl' \g
<<
(4 rows)
>>
* \q
<<
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t5\g
<<
~
>>
* create table b119967_1t5 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* insert into b119967_1t5 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','julie1 blob data1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t5 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','julie2 blob data2','them2','');  \g
<<
(1 row)
>>
* update b119967_1t5 set notes_text='blahblahblah' where notes_id = 2;  \g
<<
(1 row)
>>
* update b119967_1t5 set julie_text='julie1 bogus data' where notes_id=1;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 3  
<<
~
>>
? auditdb -file -table=b119967_1t5 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t2 () from 'b119967_1t5.trl' \g
<<
(6 rows)
>>
* \q
<<
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t6\g
<<
~
>>
* create table b119967_1t6 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* insert into b119967_1t6 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','julie1 blob data1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t6 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','julie2 blob data2','them2','');  \g
<<
(1 row)
>>
* update b119967_1t6 set report_id=999 where notes_id=2;  \g
<<
(1 row)
>>
* update b119967_1t6 set report_id=555 where notes_id=1;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t6 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t2 () from 'b119967_1t6.trl' \g
<<
(6 rows)
>>
* \q
<<
>>
? ckpdb +j +w b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t7\g
<<
~
>>
* create table b119967_1t7 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null, -
more_julie long varchar with null -
) with journaling;  \g
<<
>>
* drop table b119967_2t3\g
<<
~
>>
* create table b119967_2t3 ( -
date date not null with default, -
username char(32) not null with default, -
operation char(8) not null with default, -
tranid1 integer4 not null with default, -
tranid2 integer4 not null with default, -
table_id1 integer4 not null with default, -
table_id2 integer4 not null with default, -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null, -
more_julie long varchar with null -
) with nojournaling;  \g
<<
>>
* insert into b119967_1t7 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','julie1 blob data1','them1','','XXXmorejulieXXX');  \g
<<
(1 row)
>>
* insert into b119967_1t7 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','julie2 blob data2','them2','','YYYmorejulieYYY');  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t7 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t3 () from 'b119967_1t7.trl' \g
<<
(2 rows)
>>
* \q
<<
>>
? ckpdb +j +w b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t8\g
<<
~
>>
* create table b119967_1t8 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
julie_text long varchar with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null, -
more_julie long varchar with null -
) with journaling;  \g
<<
>>
* insert into b119967_1t8 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','julie1 blob data1','them1','','XXXmorejulieXXX');  \g
<<
(1 row)
>>
* insert into b119967_1t8 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','julie2 blob data2','them2','','YYYmorejulieYYY');  \g
<<
(1 row)
>>
* delete from b119967_1t8 where notes_id=1;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t8 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t3 () from 'b119967_1t8.trl' \g
<<
(3 rows)
>>
* \q
<<
>>
? ckpdb +w +j b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* drop table b119967_1t9\g
<<
~
>>
* create table b119967_1t9 ( -
notes_id integer4 not null not default, -
update_dtm date with null, -
notetype_name varchar(35) with null, -
report_id integer4 with null, -
notes_text long varchar with null, -
create_dtm date with null, -
create_usr varchar(50) with null, -
update_usr varchar(50) with null, -
delete_flag char(1) with null -
) with journaling;  \g
<<
>>
* insert into b119967_1t9 values (1,'now','notetype_name1',null,'A Long Varchar 1','today','you1','them1','');  \g
<<
(1 row)
>>
* insert into b119967_1t9 values (2,'now','notetype_name2',null,'A Long Varchar 2','today','you2','them2','');  \g
<<
(1 row)
>>
* delete from b119967_1t9 where notes_id=1;  \g
<<
(1 row)
>>
* \q
<<
>>
? sleep 10  
<<
~
>>
? auditdb -file -table=b119967_1t9 b119967db  
<<
~
>>
? sql -s b119967db
<< 

>> 
* copy table b119967_2t () from 'b119967_1t9.trl' \g
<<
(3 rows)
>>
* \q
<<
>>
