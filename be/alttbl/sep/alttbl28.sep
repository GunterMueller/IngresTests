/*
	Test Name: alttbl28.sep
	Time: Thu Jan 23 04:18:06 1997
	User Name: testenv
	Terminal type: septerm
 
	Test ID : (TBD)
	Module  : 
	Filename:
	Purpose	:
	Input Files  :
	Output Files :
	Database     :
	Tables       :
	Synopsis     : Unique constaints should be detectd in alter table 
		       statement .  When try to drop a column which has unique
		       constaints on it, Alter table with option restrict should
		       give error message, and with option cascade should 
		       drop unique constraint also.

 History: 23-Jan-1997	(wanya01)	Created
	  19-Mar-1999	(vande02)	Hard-coded VPG_SZ to 4K 
*/
? fill alttbl28.sql 
!!
/* testing drop column and column has unique constriant  */
set autocommit on \p\g
drop table t \p\g       
select * from iiconstraints \p\g
create table t(col1 int , col2 int not null, col3 int) with 
page_size = 4096 \p\g
alter table t add constraint c1 unique (col2) \p\g
select * from iiconstraints \p\g
insert into t values (1,2,3) \p\g
insert into t values (2,2,3) \p\g
alter table t drop column col2 restrict \p\g
alter table t drop column col2 cascade \p\g
select * from iiconstraints \p\g
drop table t \p\g

set autocommit on \p\g
drop table t \p\g       
select * from iiconstraints \p\g
create table t(col1 int , col2 int not null, col3 int not null ) 
with page_size = 4096 \p\g
alter table t add constraint c1 unique(col2, col3) \p\g
select * from iiconstraints \p\g
insert into t values (1,2,3) \p\g
insert into t values (2,2,3) \p\g
alter table t drop column col2 restrict \p\g
alter table t drop column col2 cascade \p\g
select * from iiconstraints \p\g
drop table t \p\g

create table t(col1 int , col2 int not null) with page_size = 4096 \p\g
alter table t add constraint c1 unique(col2) \p\g
alter table t add constraint c2 unique(col2) \p\g
alter table t add constraint c3 unique(col2) \p\g
select * from iiconstraints \p\g
alter table t drop column col2 restrict \p\g
alter table t drop column col2 cascade \p\g
select * from iiconstraints \p\g
drop table t \p\g

!!
? sql -s SEPPARAMDB 
<<

>>
* \i alttbl28.sql 
<<
/* SQL Startup File */
/* testing drop column and column has unique constriant  */
set autocommit on 
drop table t 
E_US0AC1 DROP: 't' does not exist or is not owned by you.
    (Thu Jan 23 04:21:24 1997)

       
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(0 rows)
create table t(col1 int , col2 int not null, col3 int) with 
page_size = 4096 
alter table t add constraint c1 unique (col2) 
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|c1                              |testenv                         |t                -
               |U     |1997_01_22 19:21:28 GMT  |            1| UNIQUE(col2)        -
                                                                                    -
                                                                                    -
                                                   |U     |
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(1 row)
insert into t values (1,2,3) 
(1 row)
insert into t values (2,2,3) 
E_US1194 Duplicate key on INSERT detected.
    (Thu Jan 23 04:21:31 1997)

alter table t drop column col2 restrict 
E_QE016B ALTER TABLE DROP COLUMN RESTRICT:  restricted destruction of base
    table column cannot proceed as it  has one or more dependent objects
    which would become abandoned.
    (Thu Jan 23 04:21:31 1997)

alter table t drop column col2 cascade 
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(0 rows)
drop table t 

set autocommit on 
drop table t 
E_US0AC1 DROP: 't' does not exist or is not owned by you.
    (Thu Jan 23 04:21:33 1997)

       
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(0 rows)
create table t(col1 int , col2 int not null, col3 int not null ) 
with page_size = 4096 
alter table t add constraint c1 unique(col2, col3) 
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|c1                              |testenv                         |t                -
               |U     |1997_01_22 19:21:33 GMT  |            1| UNIQUE(col2, col3)  -
                                                                                    -
                                                                                    -
                                                   |U     |
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(1 row)
insert into t values (1,2,3) 
(1 row)
insert into t values (2,2,3) 
E_US1194 Duplicate key on INSERT detected.
    (Thu Jan 23 04:21:35 1997)

alter table t drop column col2 restrict 
E_QE016B ALTER TABLE DROP COLUMN RESTRICT:  restricted destruction of base
    table column cannot proceed as it  has one or more dependent objects
    which would become abandoned.
    (Thu Jan 23 04:21:35 1997)

alter table t drop column col2 cascade 
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(0 rows)
drop table t 

create table t(col1 int , col2 int not null) with page_size = 4096 
alter table t add constraint c1 unique(col2) 
alter table t add constraint c2 unique(col2) 
E_PS047D ALTER TABLE: UNIQUE constraints 'c2' and 'c1' have conflicting
    sets of columns. 
    The set of columns of one UNIQUE constraint cannot be the same as the
    set of columns of another UNIQUE constraint on the same table.
    (Thu Jan 23 04:21:37 1997)

alter table t add constraint c3 unique(col2) 
E_PS047D ALTER TABLE: UNIQUE constraints 'c3' and 'c1' have conflicting
    sets of columns. 
    The set of columns of one UNIQUE constraint cannot be the same as the
    set of columns of another UNIQUE constraint on the same table.
    (Thu Jan 23 04:21:37 1997)

select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|c1                              |testenv                         |t                -
               |U     |1997_01_22 19:21:36 GMT  |            1| UNIQUE(col2)        -
                                                                                    -
                                                                                    -
                                                   |U     |
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(1 row)
alter table t drop column col2 restrict 
E_QE016B ALTER TABLE DROP COLUMN RESTRICT:  restricted destruction of base
    table column cannot proceed as it  has one or more dependent objects
    which would become abandoned.
    (Thu Jan 23 04:21:37 1997)

alter table t drop column col2 cascade 
select * from iiconstraints 

+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
|constraint_name                 |schema_name                     |table_name       -
               |constr|create_date              |text_sequence|text_segment         -
                                                                                    -
                                                                                    -
                                                   |system|
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
+--------------------------------+--------------------------------+------------------
---------------+------+-------------------------+-------------+----------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
---------------------------------------------------+------+
(0 rows)
drop table t 
>>
* \q 
<<

>>


Ending at: Thu Jan 23 04:24:30 1997
