/*
	Test Name: alttbl39.sep
	Time: Tue May 27 16:00:32 1997
	User Name: testenv
	Terminal type: septerm
 
	Test ID : alttbl39
	Module  : be/alttbl
	Filename: alttbl39.sep
	Purpose	: To test bug b81767
	Input Files  : none
	Output Files : none
	Database     : alttbldb
	Tables       : tbl_alttbl39
	Synopsis     : Object integrity should be dropped if the column it
		       depends on is dropped.   

 History: 27-May-1997	(Author)	Created
	  23-Mar-1999	(kamra01) Modified the page_size to 8K instead of 
			vpg_sz.	 
          17-Jun-2004	(shafa01) Added order by clause for the select
			statements preformed against iiintegrities table.
			Rearranged history display. Changed table name from
			t to tbl_alttbl39. Added missing test information from
			the header section. Also removed huge fill file and
			added a canon for every SQL statement.
  
*/
? sql -s SEPPARAMDB 
<<
>>
* set autocommit on \g
<<
>>
* drop table tbl_alttbl39 \g
<<
~
>>
* create table tbl_alttbl39 (col1 int , col2 int, col3 int)
<<
>>
* with page_size = 8192 \g
<<
>>
* create integrity  on tbl_alttbl39 is col2 >0 \g
<<
>>
* insert into tbl_alttbl39 values (1,3,3) \g
<<
(1 row)
>>
* create integrity on tbl_alttbl39 is col2 >1 \g
<<
>>
* create integrity on tbl_alttbl39 is col2 >2 \g
<<
>>
* select * from iiintegrities order by 1,2,3,4,5,6 \g
<<

+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|table_name                      |table_owner                     |create_date      -
        |integr|text_sequence|text_segment                                          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|tbl_alttbl39                    |testenv                         |2004_06_17 21:40:-
47 GMT  |     1|            1|create integrity  on tbl_alttbl39 is col2 >0          -
                                                                                    -
                                                                                    -
                  |
|tbl_alttbl39                    |testenv                         |2004_06_17 21:40:-
47 GMT  |     2|            1|create integrity  on tbl_alttbl39 is col2 >1          -
                                                                                    -
                                                                                    -
                  |
|tbl_alttbl39                    |testenv                         |2004_06_17 21:40:-
47 GMT  |     3|            1|create integrity  on tbl_alttbl39 is col2 >2          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
(3 rows)
>>
* insert into tbl_alttbl39 values (1,1,1) \g
<<
(0 rows)
>>
* alter table tbl_alttbl39 drop column col2 restrict \g
<<
E_QE016B ALTER TABLE DROP COLUMN RESTRICT:  restricted destruction of base
    table column cannot proceed as it  has one or more dependent objects
    which would become abandoned.
    (Thu Jun 17 16:36:16 2004)

>>
* alter table tbl_alttbl39 drop column col2 cascade \g
<<
>>
* insert into tbl_alttbl39 values(4,5) \g     
<<
(1 row)
>>
* select * from tbl_alttbl39 order by 1 \g
<<

+-------------+-------------+
|col1         |col3         |
+-------------+-------------+
|            1|            3|
|            4|            5|
+-------------+-------------+
(2 rows)
>>
* select * from iiintegrities order by 1,2,3,4,5,6 \g
<<

+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|table_name                      |table_owner                     |create_date      -
        |integr|text_sequence|text_segment                                          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
(0 rows)
>>
* drop table tbl_alttbl39 \g
<<
>>
* create table tbl_alttbl39 (col1 int , col2 int) with page_size = 8192 \g
<<
>>
* create integrity  on tbl_alttbl39 is col2 >0 \g
<<
>>
* select * from iiintegrities order by 1,2,3,4,5,6 \g
<<

+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|table_name                      |table_owner                     |create_date      -
        |integr|text_sequence|text_segment                                          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|tbl_alttbl39                    |testenv                         |2004_06_17 21:36:-
23 GMT  |     1|            1|create integrity  on tbl_alttbl39 is col2 >0          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
(1 row)
>>
* insert into tbl_alttbl39 values(-3,-9) \g
<<
(0 rows)
>>
* alter table tbl_alttbl39 drop column col2 restrict \g
<<
E_QE016B ALTER TABLE DROP COLUMN RESTRICT:  restricted destruction of base
    table column cannot proceed as it  has one or more dependent objects
    which would become abandoned.
    (Thu Jun 17 16:36:26 2004)

>>
* alter table tbl_alttbl39 drop column col2 cascade \g
<<
>>
/* 
	integrity on col2 should be dropped   
*/
* select * from iiintegrities order by 1,2,3,4,5,6 \g
<<

+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
|table_name                      |table_owner                     |create_date      -
        |integr|text_sequence|text_segment                                          -
                                                                                    -
                                                                                    -
                  |
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
+--------------------------------+--------------------------------+------------------
--------+------+-------------+-------------------------------------------------------
-------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------
------------------+
(0 rows)
>>
* alter table tbl_alttbl39 add column col2 integer \g
<<
>>
* create integrity  on tbl_alttbl39 is col2 >0 \g
<<
>>
* insert into tbl_alttbl39 values(-3,-9) \g
<<
(0 rows)
>>
* drop table tbl_alttbl39 \g
<<
>>
* \q 
<<
>>


Ending at: Thu Jun 17 16:41:26 2004
