/*
  Copyright (c) 2010 Ingres Corporation

  Test Name     : dt98.sep
  Suite         : be!datatypes
  Focus         : Ingres 10.0 New Data Type:  BOOLEAN with alter table,
		  constraints (column, table), create index, and
		  copy table from/into a file.

  Databases     : SEPPARAMDB1 (datatypedb)
  Tables        : dt98_t1, dt98_t2, dt98_t3, dt98_t4, dt98_t5
  Indexes	: dt98_t3_idx1 
  Filled Files  : dt98_t3.dat
  Copied Files  : 
  Output Files  : dt98_t3_out.dat
  Prerequisites : None 
  Run as user   : testenv
  Summary       : Basic functionality test:
			* alter table drop|add column
			* alter table alter column with default TRUE|FALSE
			* alter table alter column with default NULL
			* alter table alter column with null default TRUE
			* alter table alter column with default TRUE and alter
			  that column to with null default FALSE
			* alter table add constraint dt98_con1 CHECK = TRUE
			* create index dt98_t3_idx1 on a BOOLEAN column
			* copy table from dt98_t3.dat
			* delcare global temporary table dt98_gtt3 as select
			* copy table into dt98_t3_out.dat
			* alter table add constraint dt98_con2 CHECK = FALSE
			* table level contraint dt98_con3 PRIMARY KEY on BOOLEAN
  Known Issues  : 143121 - ADF errors with SELECT on secondary index table
			   using IS TRUE or IS FALSE.  See comment below.

  History       : 14-Jan-2010 (vande02) Created.
		: 23-Feb-2010 (vande02) Added Table Level Constraint and global
					temporary table.
                : 22-Apr-2010 (vande02) Corrected SEPPARAMDB to SEPPARAMDB1.
*/
? fill dt98_t3.dat
!!
!!
? fill dt98_t3.dat 
!!
true	0	0
true	1	1
true	2	2
true	3	3
true	4	4
false	5	5
true	6	6
true	7	7
true	8	8
true	9	9
false	10	10
true	11	11
true	12	12
true	13	13
true	14	14
false	15	15
true	16	16
true	17	17
true	18	18
true	19	19
false	20	20
true	21	21
true	22	22
true	23	23
true	24	24
false	25	25
true	26	26
true	27	27
true	28	28
true	29	29
false	30	30
true	31	31
true	32	32
true	33	33
true	34	34
false	35	35
true	36	36
true	37	37
true	38	38
true	39	39
false	40	40
true	41	41
true	42	42
true	43	43
true	44	44
false 	45	45
true	46	46
true	47	47
true	48	48
true	49	49
false	50	50
true	51	51
true	52	52
true	53	53
true	54	54
false	55	55
true	56	56
true	57	57
true	58	58
true	59	59
false	60	60
true	61	61
true	62	62
true	63	63
true	64	64
false	65	65
true	66	66
true	67	67
true	68	68
true	69	69
false	70	70
true	71	71
true	72	72
true	73	73
true	74	74
false 	75	75
true	76	76
true	77	77
true	78	78
true	79	79
false	80	80
true	81	81
true	82	82
true	83	83
true	84	84
false 	85	85
true	86	86
true	87	87
true	88	88
true	89	89
false	90	90
true	91	91
true	92	92
true	93	93
true	94	94
false	95	95
true	96	96
true	97	97
true	98	98
true	99	99
false	100	100
!!
? sql -s SEPPARAMDB1 
<<
>>
* drop dt98_t1, dt98_t2, dt98_t3, dt98_t4, dt98_t5\g
<<
~
>>
* create table dt98_t1(col1_id integer, col2_bool boolean with default,-
  col3_bool boolean with default, col4_bool boolean with default,-
  col5_string varchar(25)) with page_size=4096\g 
<<
>>
* insert into dt98_t1 values (100, 1, 0, null, 'true-false-null')\g 
<<
(1 row)
>>
* insert into dt98_t1 values (200, true, false, null, 'true-false-null')\g 
<<
(1 row)
>>
* insert into dt98_t1 values (300, default, default, default,-
  'default-default-default')\g 
<<
(1 row)
>>
* modify dt98_t1 to btree with compression=(nokey,hidata)\g 
<<
(3 rows)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-----+-------------------------+
|col1_id      |col2_|col3_|col4_|col5_string              |
+-------------+-----+-----+-----+-------------------------+
|          100|TRUE |FALSE|     |true-false-null          |
|          200|TRUE |FALSE|     |true-false-null          |
|          300|FALSE|FALSE|FALSE|default-default-default  |
+-------------+-----+-----+-----+-------------------------+
(3 rows)
>>
* commit\g
<<
>>
* alter table dt98_t1 drop col2_bool cascade\g 
<<
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-------------------------+
|col1_id      |col3_|col4_|col5_string              |
+-------------+-----+-----+-------------------------+
|          100|FALSE|     |true-false-null          |
|          200|FALSE|     |true-false-null          |
|          300|FALSE|FALSE|default-default-default  |
+-------------+-----+-----+-------------------------+
(3 rows)
>>
* alter table dt98_t1 add column col6_bool boolean with default not null\g
<<
>>
* insert into dt98_t1 values (400,default,default,-
  'added new boolean column',default)\g 
<<
(1 row)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-------------------------+-----+
|col1_id      |col3_|col4_|col5_string              |col6_|
+-------------+-----+-----+-------------------------+-----+
|          100|FALSE|     |true-false-null          |FALSE|
|          200|FALSE|     |true-false-null          |FALSE|
|          300|FALSE|FALSE|default-default-default  |FALSE|
|          400|FALSE|FALSE|added new boolean column |FALSE|
+-------------+-----+-----+-------------------------+-----+
(4 rows)
>>
* update dt98_t1 set col3_bool=TRUE where col3_bool != TRUE\g
<<

(4 rows)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-------------------------+-----+
|col1_id      |col3_|col4_|col5_string              |col6_|
+-------------+-----+-----+-------------------------+-----+
|          100|TRUE |     |true-false-null          |FALSE|
|          200|TRUE |     |true-false-null          |FALSE|
|          300|TRUE |FALSE|default-default-default  |FALSE|
|          400|TRUE |FALSE|added new boolean column |FALSE|
+-------------+-----+-----+-------------------------+-----+
(4 rows)
>>
* rollback\g
<<
>>
* alter table dt98_t1 alter column col2_bool boolean with default TRUE\g
<<
>>
* alter table dt98_t1 alter column col3_bool boolean with default FALSE\g
<<
>>
* insert into dt98_t1 values (400,default,default,default,-
  'default-default-default')\g 
<<
(1 row)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-----+-------------------------+
|col1_id      |col2_|col3_|col4_|col5_string              |
+-------------+-----+-----+-----+-------------------------+
|          100|TRUE |FALSE|     |true-false-null          |
|          200|TRUE |FALSE|     |true-false-null          |
|          300|FALSE|FALSE|FALSE|default-default-default  |
|          400|TRUE |FALSE|FALSE|default-default-default  |
+-------------+-----+-----+-----+-------------------------+
(4 rows)
>>
* rollback\g
<<
>>
* alter table dt98_t1 alter column col4_bool boolean with default NULL\g
<<
>>
* insert into dt98_t1 values (500,default,default,default,-
  'default-default-default')\g
<<
(1 row)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-----+-------------------------+
|col1_id      |col2_|col3_|col4_|col5_string              |
+-------------+-----+-----+-----+-------------------------+
|          100|TRUE |FALSE|     |true-false-null          |
|          200|TRUE |FALSE|     |true-false-null          |
|          300|FALSE|FALSE|FALSE|default-default-default  |
|          500|FALSE|FALSE|     |default-default-default  |
+-------------+-----+-----+-----+-------------------------+
(4 rows)
>>
* rollback\g
<<
>>
* alter table dt98_t1 alter column col2_bool boolean with null default TRUE\g
<<
>>
* insert into dt98_t1 values (600,default,default,default,-
  'default-default-default')\g
<<
(1 row)
>>
* select * from dt98_t1 order by 1\g
<<

+-------------+-----+-----+-----+-------------------------+
|col1_id      |col2_|col3_|col4_|col5_string              |
+-------------+-----+-----+-----+-------------------------+
|          100|TRUE |FALSE|     |true-false-null          |
|          200|TRUE |FALSE|     |true-false-null          |
|          300|FALSE|FALSE|FALSE|default-default-default  |
|          600|TRUE |FALSE|FALSE|default-default-default  |
+-------------+-----+-----+-----+-------------------------+
(4 rows)
>>
* rollback\g
<<
>>
* create table dt98_t2(col1_id integer1,-
  col2_bool boolean with default true,-
  col3_string varchar(25)) with page_size=4096\g 
<<
>>
* commit\g
<<
>>
* insert into dt98_t2 values (100,default,'test default is true')\g
<<
(1 row)
>>
* select * from dt98_t2 order by 1\g
<<

+------+-----+-------------------------+
|col1_i|col2_|col3_string              |
+------+-----+-------------------------+
|   100|TRUE |test default is true     |
+------+-----+-------------------------+
(1 row)
>>
* alter table dt98_t2 alter column col2_bool boolean with null default FALSE\g
<<
>>
* insert into dt98_t2 values (101,default,'test default is false')\g
<<
(1 row)
>>
* select * from dt98_t2 order by 1\g
<<

+------+-----+-------------------------+
|col1_i|col2_|col3_string              |
+------+-----+-------------------------+
|   100|TRUE |test default is true     |
|   101|FALSE|test default is false    |
+------+-----+-------------------------+
(2 rows)
>>
* rollback\g
<<
>>
/*
Alter table adding a column level constraint dt98_con1 to CHECK BOOLEAN
column col2_bool equals TRUE.
*/
* alter table dt98_t2 add constraint dt98_con1 CHECK (col2_bool = TRUE)\g
<<
>>
* insert into dt98_t2 values (101,null,'test constraint null')\g
<<

(1 row)
>>
* insert into dt98_t2 values (101,false,'test constraint false')\g
<<

E_US1905 Check integrity constraint '"dt98_con1"'
    on table '"dt98_t2"' was violated.
    (Thu Jan 14 17:36:15 2010)
>>
* insert into dt98_t2 values (102,true,'test constraint true')\g
<<

(1 row)
>>
* select * from dt98_t2 order by 1\g
<<

+------+-----+-------------------------+
|col1_i|col2_|col3_string              |
+------+-----+-------------------------+
|   101|     |test constraint null     |
|   102|TRUE |test constraint true     |
+------+-----+-------------------------+
(2 rows)
>>
* create table dt98_t3(col1_bool boolean not null, col2_int integer not null,-
  col3_varchar varchar(20)) with nojournaling\g 
<<
>>
* copy table dt98_t3(col1_bool=c0tab, col2_int=c0tab,-
  col3_varchar=c0nl) from 'dt98_t3.dat'\g
<<
(101 rows)
>>
* create index dt98_t3_idx1 on dt98_t3 (col1_bool, col2_int)-
  with structure=btree, key=(col1_bool, col2_int)\g 
<<
(101 rows)
>>
* select count(*) from dt98_t3 where col1_bool > false\g 
<<

+-------------+
|col1         |
+-------------+
|           81|
+-------------+
(1 row)
>>
* select count(*) from dt98_t3 where col1_bool < true \g 
<<
+-------------+
|col1         |
+-------------+
|           20|
+-------------+
(1 row)
>>
* select col1_bool, col2_int from dt98_t3 where col1_bool = FALSE-
  order by col1_bool, col2_int\g
<<
+-----+-------------+
|col1_|col2_int     |
+-----+-------------+
|FALSE|            5|
|FALSE|           10|
|FALSE|           15|
|FALSE|           20|
|FALSE|           25|
|FALSE|           30|
|FALSE|           35|
|FALSE|           40|
|FALSE|           45|
|FALSE|           50|
|FALSE|           55|
|FALSE|           60|
|FALSE|           65|
|FALSE|           70|
|FALSE|           75|
|FALSE|           80|
|FALSE|           85|
|FALSE|           90|
|FALSE|           95|
|FALSE|          100|
+-----+-------------+
(20 rows)
>>
/*
Issue 143121 - Select on Seconary Index table fails with ADF errors
when IS [NOT] TRUE|FALSE is used in the where clause. Add these queries
when issue is fixed.

* select * from dt98_t3_idx1 where col1_bool IS FALSE\g
* select count(*) from dt98_t3_idx1 where col1_bool IS TRUE\g
*/
* declare global temporary table testenv.dt98_gtt3 (active, empid)-
  as select col1_bool, col2_int from dt98_t3 where col1_bool IS FALSE-
  on commit preserve rows with norecovery\g
<<
(20 rows)
>>
* commit\g
<<
>>
* select * from dt98_gtt3 order by empid\g
<<

+-----+-------------+
|activ|empid        |
+-----+-------------+
|FALSE|            5|
|FALSE|           10|
|FALSE|           15|
|FALSE|           20|
|FALSE|           25|
|FALSE|           30|
|FALSE|           35|
|FALSE|           40|
|FALSE|           45|
|FALSE|           50|
|FALSE|           55|
|FALSE|           60|
|FALSE|           65|
|FALSE|           70|
|FALSE|           75|
|FALSE|           80|
|FALSE|           85|
|FALSE|           90|
|FALSE|           95|
|FALSE|          100|
+-----+-------------+
(20 rows)
>>
* copy table dt98_t3 () into 'dt98_t3_out.dat'\g
<<

(101 rows)
>>
* drop table dt98_t3\g
<<
>>
* select * from dt98_t3\g
<<

E_US0845 Table 'dt98_t3' does not exist or is not owned by you.
    (Thu Jan 14 19:10:20 2010)

>>
* create table dt98_t3(col1_bool boolean not null, col2_int integer not null,-
  col3_varchar varchar(20)) with nojournaling \g 
<<
>>
* copy table dt98_t3(col1_bool=c0tab, col2_int=c0tab,-
  col3_varchar=c0nl) from 'dt98_t3.dat'\g
<<
(101 rows)
>>
* select count(*) from dt98_t3\g
<<

+-------------+
|col1         |
+-------------+
|          101|
+-------------+
(1 row)
>>
* select count(*) from dt98_t3 where col1_bool = FALSE\g
<<

+-------------+
|col1         |
+-------------+
|           20|
+-------------+
(1 row)
>>
* select count(*) from dt98_t3 where col1_bool = TRUE\g
<<

+-------------+
|col1         |
+-------------+
|           81|
+-------------+
(1 row)
>>
* create table dt98_t4(col1_id integer1,-
  col2_bool boolean with default false,-
  col3_string varchar(25)) with page_size=4096\g 
<<
>>
* commit\g
<<
>>
/*
Alter table adding a column level constraint dt98_con2 to CHECK BOOLEAN
column col2_bool equals FALSE.
*/
* alter table dt98_t4 add constraint dt98_con2 CHECK (col2_bool = false)\g
<<
>>
* insert into dt98_t4 values (110,null,'test constraint null')\g
<<

(1 row)
>>
* insert into dt98_t4 values (111,true,'test constraint FALSE')\g
<<

E_US1905 Check integrity constraint '"dt98_con2"'
    on table '"dt98_t4"' was violated.
    (Tue Feb 16 18:58:46 2010)
>>
* insert into dt98_t4 values (111,1,'test constraint FALSE')\g
<<

E_US1905 Check integrity constraint '"dt98_con2"'
    on table '"dt98_t4"' was violated.
    (Tue Feb 16 19:00:41 2010)
>>
 insert into dt98_t4 values (111,'TRUE','test constraint FALSE')\g
<<

E_US1905 Check integrity constraint '"dt98_con2"'
    on table '"dt98_t4"' was violated.
    (Tue Feb 16 19:01:43 2010)
>>
* insert into dt98_t4 values (111,'FALSE','test constraint FALSE')\g
<<
(1 row)
>>
* select * from dt98_t4 order by 1\g
<<

+------+-----+-------------------------+
|col1_i|col2_|col3_string              |
+------+-----+-------------------------+
|   110|     |test constraint null     |
|   111|FALSE|test constraint FALSE    |
+------+-----+-------------------------+
(2 rows)
>>
/*
Table level contraint dt98_con3 PRIMARY KEY includes BOOLEAN column 'active'.
*/
* create table dt98_t5(accountid integer4 not null,-
  active boolean not null, salesrep varchar(25) not null,-
  constraint dt98_con3 primary key(active, salesrep))\g
<<
>>
* insert into dt98_t5 values(1001,'true','Sally Smith')\g
<<
(1 row)
>>
* insert into dt98_t5 values(1002,false,'Sam Jones')\g
<<
(1 row)
>>
* insert into dt98_t5 values(1003,TRUE,'Diane Johnson')\g
<<
(1 row)
>>
* insert into dt98_t5 values(1004,'false','Hank Swenson')\g
<<
(1 row)
>>
* insert into dt98_t5 values(1005,1,'Samuel Adams')\g
<<
(1 row)
>>
* insert into dt98_t5 values(1006,0,'Susan Wu')\g
<<
(1 row)
>>
/*
These inserts will fail because a PRIMARY KEY cannot be NULL nor
can it be a DUPLICATE row.
*/
* insert into dt98_t5 values(1007,null,'Denise Fierke')\g
<<

E_US0AD9 INSERT: Must not insert NULL value into a nonnullable column
    'active'.
    (Tue Feb 23 11:25:23 2010)
>>
* insert into dt98_t5 values(1007,1,'Sally Smith')\g
<<

E_US1194 Duplicate key on INSERT detected.
    (Tue Feb 23 11:28:55 2010)
>>
* insert into dt98_t5 values(1008,'FALSE','Susan Wu')\g
<<

E_US1194 Duplicate key on INSERT detected.
    (Tue Feb 23 11:29:12 2010)
>>
* select * from dt98_t5 order by accountid\g
<<

+-------------+-----+-------------------------+
|accountid    |activ|salesrep                 |
+-------------+-----+-------------------------+
|         1001|TRUE |Sally Smith              |
|         1002|FALSE|Sam Jones                |
|         1003|TRUE |Diane Johnson            |
|         1004|FALSE|Hank Swenson             |
|         1005|TRUE |Samuel Adams             |
|         1006|FALSE|Susan Wu                 |
+-------------+-----+-------------------------+
(6 rows)
>>
* \q 
<<
>>
? delete dt98_t3_out.dat
<<
~
>>
