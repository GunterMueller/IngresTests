/*
  Copyright (c) 2008 Ingres Corporation

  Test Name     : dtu41.sep
  Suite         : be!datatypes
  Focus         : Ingres Regression Test
                : Test for bug 116562 - ASCII copy out of table where first
                : column is a system maintained key fails with E_CO0029
                :
                :
  Databases     : SEPPARAMDB3 - Requires unicode database
  Tables        : b116562_*
  Filled Files  : 
  Copied Files  :
  Output Files  :
  Prerequisites : None
  Run as user   : testenv 
  Summary       : Verifies fix for bug 116562
                :
                :
  Exp. DIFFs    : None
                :
  History       : 15-Aug-2008 (wanfr01) Created.
                : 15-Aug-2008 (sarjo01) Formalized for piccolo.
                : 22-Oct-2008 (wanfr01) Test does not currently run on VMS
*/
.if !(VMS)
? fill b116562_t1.dat
!!
!!
? fill b116562_t2.dat
!!
!!
? fill b116562_t3.dat
!!
!!
? sql -s SEPPARAMDB3
<< 
>> 
* drop table b116562_t1\g
<<
~
>>
* create table b116562_t1( -
	id integer not null, -
	search_text nvarchar(255) collate unicode_case_insensitive, -
	search_quality integer, -
	num_matches integer, -
	top_match_id integer, -
	user_id nvarchar(100) collate unicode_case_insensitive, -
	asked_date integer, -
	search_type integer, -
	external_id nvarchar(50) collate unicode_case_insensitive, -
	method_type integer, -
	method_performance integer, -
	fuzziness integer, -
	match_type integer, -
	search_in integer, -
	primary_order nvarchar(50) collate unicode_case_insensitive, -
	secondary_order integer, -
	order_direction integer, -
	rows_to_fetch integer, -
	rows_found integer, -
	filter_data nvarchar(4000) collate unicode_case_insensitive, -
	keywords long nvarchar, -
	sql_text nvarchar(4000) collate unicode_case_insensitive, -
	session_id integer default 0, -
	unique_word_count integer, -
	word_count integer, -
	best_ids nvarchar(110) collate unicode_case_insensitive -
) \g
<<
>>
* modify b116562_t1 to btree unique on -
	id \g
<<
(0 rows)
>>
* insert into b116562_t1 values( -
1,'hello world',1,1,1, -
'userid1',1,1,'external_id1',1, -
1,1,1,1,'primary_order', -
1,1,1,1,'filter_data', -
'keywords1keywords1keywords1keywords1keywords1keywords1keywords1keywo-
rds1keywords1keywords1keywords1keywords1keywords1keywords1', -
'sql_text',1,1,1,'best_ids')  \g
<<
(1 row)
>>
* insert into b116562_t1 values( -
2,'hello world',2,2,2, -
'userid2',2,2,'external_id2',2, -
2,2,2,2,'primary_order', -
2,2,2,2,'filter_data', -
'keywords2keywords2keywords2keywords2keywords2keywords2keywords2keywo-
rds2keywords2keywords2keywords2keywords2keywords2keywords2', -
'sql_text',2,2,2,'best_ids')  \g
<<
(1 row)
>>
* insert into b116562_t1 values( -
3,'hello world',3,3,3, -
'userid3',3,3,'external_id3',3, -
3,3,3,3,'primary_order', -
3,3,3,3,'filter_data', -
'keywords3keywords3keywords3keywords3keywords3keywords3keywords3key-
words3keywords3keywords3keywords3keywords3keywords3keywords3', -
'sql_text',3,3,3,'best_ids')  \g
<<
(1 row)
>>
* drop table b116562_t2\g
<<
~
>>
* create table b116562_t2( -
	id integer not null, -
	keywords long nvarchar, -
	sql_text nvarchar(4000) collate unicode_case_insensitive -
) \g
<<
>>
* modify b116562_t2 to btree unique on -
	id \g
<<
(0 rows)
>>
* insert into b116562_t2 values( -
1, -
'keywords1keywords1keywords1keywords1keywords1keywords1keywords1keywords1keyw-
ords1keywords1keywords1keywords1keywords1keywords1', -
'sql_text')  \g
<<
(1 row)
>>
* insert into b116562_t2 values( -
2, -
'keywords2keywords2keywords2keywords2keywords2keywords2keywords2keywords2ke-
ywords2keywords2keywords2keywords2keywords2keywords2', -
'sql_text')  \g
<<
(1 row)
>>
* insert into b116562_t2 values( -
3, -
'keywords3keywords3keywords3keywords3keywords3keywords3keywords3keywords3k-
eywords3keywords3keywords3keywords3keywords3keywords3', -
'sql_text')  \g
<<
(1 row)
>>
* drop table b116562_t3\g
<<
~
>>
* create table b116562_t3( -
	raw_key table_key not null with system_maintained, -
	in_process char(1) not null not default, -
	log_date date not null, -
	msg long varchar -
) \g
<<
>>
* modify b116562_t3 to btree unique on -
	raw_key \g
<<
(0 rows)
>>
* insert into b116562_t3(in_process,log_date,msg) -
 values('a',date('now'),'helloworldhelloworldhelloworldhelloworld')  \g
<<
(1 row)
>>
* insert into b116562_t3(in_process,log_date,msg) -
 values('b',date('now'),'helloworldhelloworldhelloworldhelloworld')  \g
<<
(1 row)
>>
* insert into b116562_t3(in_process,log_date,msg) -
 values('c',date('now'),'helloworldhelloworldhelloworldhelloworld')  \g
<<
(1 row)
>>
* copy b116562_t2( -
	id= c0tab, -
	keywords= long nvarchar(0)tab with null(']^NULL^['), -
	sql_text= nvarchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
into 'b116562_t2.dat'  \g
<<
(3 rows)
>>
* copy b116562_t3( -
	raw_key= d0tab, -
	in_process= varchar(0)tab, -
	log_date= c0tab, -
	msg= long varchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
into 'b116562_t3.dat'  \g
<<
(3 rows)
>>
* copy b116562_t1( -
	id= c0tab, -
	search_text= nvarchar(0)tab with null(']^NULL^['), -
	search_quality= c0tab with null(']^NULL^['), -
	num_matches= c0tab with null(']^NULL^['), -
	top_match_id= c0tab with null(']^NULL^['), -
	user_id= nvarchar(0)tab with null(']^NULL^['), -
	asked_date= c0tab with null(']^NULL^['), -
	search_type= c0tab with null(']^NULL^['), -
	external_id= nvarchar(0)tab with null(']^NULL^['), -
	method_type= c0tab with null(']^NULL^['), -
	method_performance= c0tab with null(']^NULL^['), -
	fuzziness= c0tab with null(']^NULL^['), -
	match_type= c0tab with null(']^NULL^['), -
	search_in= c0tab with null(']^NULL^['), -
	primary_order= nvarchar(0)tab with null(']^NULL^['), -
	secondary_order= c0tab with null(']^NULL^['), -
	order_direction= c0tab with null(']^NULL^['), -
	rows_to_fetch= c0tab with null(']^NULL^['), -
	rows_found= c0tab with null(']^NULL^['), -
	filter_data= nvarchar(0)tab with null(']^NULL^['), -
	keywords= long nvarchar(0)tab with null(']^NULL^['), -
	sql_text= nvarchar(0)tab with null(']^NULL^['), -
	session_id= c0tab with null(']^NULL^['), -
	unique_word_count= c0tab with null(']^NULL^['), -
	word_count= c0tab with null(']^NULL^['), -
	best_ids= nvarchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
into 'b116562_t1.dat'  \g
<<
(3 rows)
>>
* \q
<<
>>
.endif
