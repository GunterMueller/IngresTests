/*
  Copyright (c) 2008 Ingres Corporation

  Test Name     : dtu40.sep
  Suite         : be!datatypes
  Focus         : Ingres Regression Test
                : Test for bug 115529 - E_QE0002 error or SEGV may occur
                : when running a query with nested outer joins
                :
  Databases     : SEPPARAMDB3 - Requires unicode database
  Tables        : b115529_*
  Filled Files  : 
  Copied Files  : b115529_*.dat
  Output Files  :
  Prerequisites : None
  Run as user   : testenv 
  Summary       : Verifies fix for bug 115529 
                :
                :
  Exp. DIFFs    : None
                :
  History       : 08-Aug-2008 (wanfr01) Created.
                : 08-Aug-2008 (sarjo01) Formalized for piccolo.
                : 22-Oct-2008 (wanfr01) Test does not currently run on VMS
*/
.if !(VMS)
? fill b115529_t1.dat
!!
!!
? cp @file(ing_tst,be,datatypes,data,b115529_t1.dat) b115529_t1.dat
<<
>>
? fill b115529_t2.dat
!!
!!
? cp @file(ing_tst,be,datatypes,data,b115529_t2.dat) b115529_t2.dat
<<
>>
? fill b115529_t3.dat
!!
!!
? cp @file(ing_tst,be,datatypes,data,b115529_t3.dat) b115529_t3.dat
<<
>>
? sql -s SEPPARAMDB3
<< 

>> 
* drop table b115529_t1\g
<<
~
>>
* create table b115529_t1( -
	merkmalsgruppen_id varchar(6) not null not default, -
	b115529_t2_id varchar(8) not null not default, -
	klasse integer, -
	mandant varchar(32) -
)\g
<<
>>
* modify b115529_t1 to btree unique on -
	merkmalsgruppen_id, -
	b115529_t2_id\g
<<
(0 rows)
>>
* copy b115529_t1( -
	merkmalsgruppen_id= varchar(0)tab, -
	b115529_t2_id= varchar(0)tab, -
	klasse= c0tab with null(']^NULL^['), -
	mandant= varchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
from 'b115529_t1.dat'\g
<<
(239 rows)
>>
* drop table b115529_t2\g
<<
~
>>
* create table b115529_t2( -
	b115529_t2_id varchar(8) not null not default, -
	bezeichnung varchar(25), -
	beschreibung varchar(76), -
	zerstoerend integer, -
	datum_cr date, -
	bearbeiter_cr varchar(6), -
	datum_md date, -
	bearbeiter_md varchar(6), -
	pruefplansachnummer varchar(30), -
	pruefplansachindex varchar(10), -
	pruefplanversion varchar(10), -
	klasse integer, -
	mandant varchar(32) -
)\g
<<
>>
* modify b115529_t2 to btree unique on -
	b115529_t2_id\g
<<
(0 rows)
>>
* copy b115529_t2( -
	b115529_t2_id= varchar(0)tab, -
	bezeichnung= varchar(0)tab with null(']^NULL^['), -
	beschreibung= varchar(0)tab with null(']^NULL^['), -
	zerstoerend= c0tab with null(']^NULL^['), -
	datum_cr= c0tab with null(']^NULL^['), -
	bearbeiter_cr= varchar(0)tab with null(']^NULL^['), -
	datum_md= c0tab with null(']^NULL^['), -
	bearbeiter_md= varchar(0)tab with null(']^NULL^['), -
	pruefplansachnummer= varchar(0)tab with null(']^NULL^['), -
	pruefplansachindex= varchar(0)tab with null(']^NULL^['), -
	pruefplanversion= varchar(0)tab with null(']^NULL^['), -
	klasse= c0tab with null(']^NULL^['), -
	mandant= varchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
from 'b115529_t2.dat'\g
<<
(79 rows)
>>
* drop table b115529_t3\g
<<
~
>>
* create table b115529_t3( -
	pruefmittelgruppe_id nvarchar(20) not null, -
	language_code varchar(10) not null, -
	bezeichnung nvarchar(100), -
	beschreibung nvarchar(250), -
	beschreibung_anbindung smallint, -
	beschreibung_tabelle varchar(36), -
	doc_intern varchar(36), -
	datum_cr date, -
	bearbeiter_cr nvarchar(20), -
	datum_md date, -
	bearbeiter_md nvarchar(20) -
)\g
<<
>>
* modify b115529_t3 to btree unique on -
	pruefmittelgruppe_id, -
	language_code\g
<<
(0 rows)
>>
* copy b115529_t3( -
	pruefmittelgruppe_id= nvarchar(0)tab, -
	language_code= varchar(0)tab, -
	bezeichnung= nvarchar(0)tab with null(']^NULL^['), -
	beschreibung= nvarchar(0)tab with null(']^NULL^['), -
	beschreibung_anbindung= c0tab with null(']^NULL^['), -
	beschreibung_tabelle= varchar(0)tab with null(']^NULL^['), -
	doc_intern= varchar(0)tab with null(']^NULL^['), -
	datum_cr= c0tab with null(']^NULL^['), -
	bearbeiter_cr= nvarchar(0)tab with null(']^NULL^['), -
	datum_md= c0tab with null(']^NULL^['), -
	bearbeiter_md= nvarchar(0)nl with null(']^NULL^['), -
	nl= d0nl) -
from 'b115529_t3.dat'\g
<<
(17 rows)
>>
* create index b115529_i4 on b115529_t2 ( -
	mandant, -
	b115529_t2_id) -
with structure = btree, -
	key = (mandant, b115529_t2_id)\g
<<
(79 rows)
>>
* SELECT b115529_t2.b115529_t2_id AS b115529_t2_id, -
       b115529_t3.bezeichnung AS bezeichnung  -
  FROM b115529_t1  -
       LEFT JOIN b115529_t2 ON  -
         b115529_t1.b115529_t2_id = b115529_t2.b115529_t2_id  -
       LEFT JOIN b115529_t3 ON -
         b115529_t2.b115529_t2_id = b115529_t3.pruefmittelgruppe_id  -
         AND b115529_t3.language_code = 'de'  -
WHERE b115529_t1.merkmalsgruppen_id = 'ABLAUF' \g
<<

+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|b115529_|bezeichnung                                                                                                                                                                                             |
+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|SICHT   |                                                                                                                                                                                                        |
+--------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
(1 row)
>>
* \q
<<
>>
.endif
